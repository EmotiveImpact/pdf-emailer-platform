#!/usr/bin/env node

/**
 * Email Configuration Setup Script
 * 
 * This script helps you set up your Mailgun credentials for the PDF Splitter application.
 * Run this script to configure your email settings.
 */

const fs = require('fs');
const path = require('path');
const readline = require('readline');

const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout
});

const configPath = path.join(__dirname, '..', 'src', 'config', 'emailCredentials.ts');

console.log('üîß Email Configuration Setup');
console.log('============================');
console.log('');
console.log('This script will help you configure your Mailgun credentials.');
console.log('You can get these from your Mailgun dashboard at https://mailgun.com');
console.log('');

const questions = [
  {
    key: 'MAILGUN_DOMAIN',
    prompt: 'Enter your Mailgun domain (e.g., mg.yourdomain.com): ',
    validate: (value) => value.includes('mg.') && value.includes('.com')
  },
  {
    key: 'MAILGUN_API_KEY',
    prompt: 'Enter your Mailgun API key (starts with "key-"): ',
    validate: (value) => value.startsWith('key-')
  },
  {
    key: 'FROM_EMAIL',
    prompt: 'Enter your sender email (e.g., statements@yourdomain.com): ',
    validate: (value) => value.includes('@') && value.includes('.')
  },
  {
    key: 'FROM_NAME',
    prompt: 'Enter your sender name (e.g., Your Company Name): ',
    validate: (value) => value.length > 0
  }
];

const answers = {};

function askQuestion(index) {
  if (index >= questions.length) {
    updateConfigFile();
    return;
  }

  const question = questions[index];
  rl.question(question.prompt, (answer) => {
    if (question.validate(answer.trim())) {
      answers[question.key] = answer.trim();
      askQuestion(index + 1);
    } else {
      console.log('‚ùå Invalid input. Please try again.');
      askQuestion(index);
    }
  });
}

function updateConfigFile() {
  const configContent = `// Email credentials configuration
// This file was automatically generated by the setup script

export const EMAIL_CREDENTIALS = {
  // Your Mailgun domain (e.g., mg.yourdomain.com)
  MAILGUN_DOMAIN: '${answers.MAILGUN_DOMAIN}',
  
  // Your Mailgun API key (starts with 'key-')
  MAILGUN_API_KEY: '${answers.MAILGUN_API_KEY}',
  
  // Default sender email
  FROM_EMAIL: '${answers.FROM_EMAIL}',
  
  // Default sender name
  FROM_NAME: '${answers.FROM_NAME}'
};

// Instructions for setting up Mailgun:
// 1. Sign up at https://mailgun.com
// 2. Verify your domain in the Mailgun dashboard
// 3. Copy your domain and API key from the Mailgun dashboard
// 4. Update the values above with your actual credentials
// 5. Save this file - the app will automatically use these credentials
`;

  try {
    fs.writeFileSync(configPath, configContent);
    console.log('');
    console.log('‚úÖ Configuration saved successfully!');
    console.log('');
    console.log('Your email credentials have been configured:');
    console.log(`  Domain: ${answers.MAILGUN_DOMAIN}`);
    console.log(`  API Key: ${answers.MAILGUN_API_KEY.substring(0, 10)}...`);
    console.log(`  From Email: ${answers.FROM_EMAIL}`);
    console.log(`  From Name: ${answers.FROM_NAME}`);
    console.log('');
    console.log('üöÄ You can now use the Email Distribution tool!');
    console.log('   The Configuration tab will show your credentials are ready.');
  } catch (error) {
    console.error('‚ùå Error saving configuration:', error.message);
  }

  rl.close();
}

// Start the setup process
askQuestion(0);
